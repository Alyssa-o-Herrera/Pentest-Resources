# Parse apache access.log

import sys
from cymruwhois import Client

def net_lookup(ips):
    try:
        c=Client()
        ips = list(set(ips)) # uniq IPs
        r = c.lookupmany_dict(ips)
        for ip in ips:
            net = r[ip].prefix; owner = r[ip].owner; cc = r[ip].cc 
            line = '%-20s # - %15s (%s) - %s' % (ip,net,cc,owner) 
            print line

    except Exception as e:
        print e


def main():
    weblog = sys.argv[1]
    ips = []
    for ip in open(weblog, 'r'):
        ip = ip.split()[0]
        ips.append(ip)
    net_lookup(ips)


if __name__ == "__main__":
    main()
