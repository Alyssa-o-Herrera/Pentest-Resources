# Usage: python email-sender.py <target-email-for-phish>
# Proof of Concept (PoC) to demonstrate sending email in Python
# Code written by @b3armunch
# You will need to change variables in main() to work in you scenario

import smtplib, sys
from time import sleep
from email.MIMEMultipart import MIMEMultipart
from email.MIMEText import MIMEText
from email.MIMEImage import MIMEImage

def sendmail(from_addr, to_addr_list, subject, message, login, password):
    # Create the root message and fill in the from, to, and subject headers
    msgRoot = MIMEMultipart('related'); msgRoot['From']= from_addr
    msgRoot['Subject'] = subject
    msgRoot['To'] = str(to_addr_list)
    msgRoot.preamble = 'This is a multi-part message in MIME format.';
    
    # Encapsulate the plain and HTML versions of the message body in an
    # 'alternative' part, so message agents can decide which they want to display.
    msgAlternative = MIMEMultipart('alternative')
    msgRoot.attach(msgAlternative)

    msgText = MIMEText('This is the alternative plain text message.')
    msgAlternative.attach(msgText)

    # We reference the image in the IMG SRC attribute by the ID we give it below
    msgText = MIMEText(message, 'html')
    msgAlternative.attach(msgText)

    # Send the email (this example assumes SMTP authentication is required)
    server = smtplib.SMTP('smtp.gmail.com:587') # This would work for Gmail, could be any SMTP server
    server.starttls()
    server.login(login, password)
    server.sendmail(from_addr, to_addr_list, msgRoot.as_string())
    server.quit()


def make_message():
    message = 'Hello <insert-user>,<br /><br />'
    message += '''Sample Message, built in HTML<br />
<br />
By placing URLs in paragraph tags <p>URL</p> you can often bypass Outlook URL filtering. <br />

//signature <br />
'''
    return message


def main():
    # Change the contents below to meet your needs "From Addr", "Subject", "login", "password", target (Email or distro)
    from_addr = '' #Spoofed Address - format: FirstName LastName <Email-to-Spoof@domain.com>
    subject = 'Test Subject'             
    target = sys.argv[1] # Target email address for phish - specify at the CLI
    message=make_message()
    login = '' # If this is Gmail you are using you may need to allow less secure apps via settings
    password = ''

    print "[+] Sending Email to: "+target
    sendmail(from_addr, target, subject, message, login, password)

if __name__=="__main__":
        main()
