# Quick script to parse nmap (.gnmap) files: IP/Port -> URL
# Normally this gets leveraged as input to another tool like -> whatweb
#
# Example: ~$ python parse_nmap.py nmap_results.gnmap
# https://10.10.146.1
# http://10.10.146.1
# https://10.10.146.67
# http://10.10.146.75:8080
# https://10.10.146.100
# http://10.10.146.100
# https://10.10.146.101:8443
# http://10.10.146.117


#!/usr/bin/env python

import sys
import re
import os

# Check for proper args
if len(sys.argv) < 2:
    print "Usage: "+sys.argv[0]+" [nmap_file.gnmap]"
    sys.exit(0)

# This will parse for common ports associated with URLs
# You can add in additional as needed by following the same syntax below
with open(sys.argv[1], 'r') as nmap_file:
    for line in nmap_file:
        if 'open' in line:
	    if re.search("443/open".format(),line):
	        print "https://" + line.split()[1]
		if '()' not in line:
		    newline = line.split()[2]
	            newline = newline.replace("(", "")
		    newline = newline.replace(")", "")
		    print "https://" + newline
				
	    if re.search("80/open".format(),line):
	        print "http://" + line.split()[1]
		if '()' not in line:
		    newline = line.split()[2]
		    newline = newline.replace("(", "")
		    newline = newline.replace(")", "")
		    print "http://" + newline

	    if re.search("8080/open".format(),line):
                print "http://" + line.split()[1]+":8080"
                if '()' not in line:
                    newline = line.split()[2]
                    newline = newline.replace("(", "")
                    newline = newline.replace(")", "")
                    print "http://" + newline+":8080"
		
	    if re.search("8000/open".format(),line):
                print "http://" + line.split()[1]+":8000"
                if '()' not in line:
                    newline = line.split()[2]
                    newline = newline.replace("(", "")
                    newline = newline.replace(")", "")
                    print "http://" + newline+":8000"


	    if re.search("8443/open".format(),line):
                print "https://" + line.split()[1]+":8443"
                if '()' not in line:
                    newline = line.split()[2]
                    newline = newline.replace("(", "")
                    newline = newline.replace(")", "")
                    print "https://" + newline+":8443"

	    if re.search("8009/open".format(),line):
                print "http://" + line.split()[1]+":8009"
                if '()' not in line:
                    newline = line.split()[2]
                    newline = newline.replace("(", "")
                    newline = newline.replace(")", "")
                    print "http://" + newline+":8009"

	    if re.search("8090/open".format(),line):
                print "http://" + line.split()[1]+":8090"
                if '()' not in line:
                    newline = line.split()[2]
                    newline = newline.replace("(", "")
                    newline = newline.replace(")", "")
                    print "http://" + newline+":8090"

	    if re.search("10000/open".format(),line):
                print "http://" + line.split()[1]+":10000"
                if '()' not in line:
                    newline = line.split()[2]
                    newline = newline.replace("(", "")
                    newline = newline.replace(")", "")
                    print "http://" + newline+":10000"
